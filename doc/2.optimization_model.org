#+TITLE:    Cincinnati Public School Bus Routing and Bell Time Optimization 
#+AUTHOR:     Shuai Wang 
#+DATE:       09/28/2019 
#+EMAIL: wang.172@wright.edu
#+SETUPFILE: https://fniessen.github.io/org-html-themes/setup/theme-bigblow.setup
** Routing: Bi-objective Routing Decomposition (BiRD)
   :PROPERTIES:
   :CUSTOM_ID: routing-bi-objective-routing-decomposition-bird
   :END:

Decomposing the routing problem:

1. single-school

   1. stop assignment
   2. single-school routing

2. multi-school

   1. scenario selection
   2. bus scheduling

*** Stop Assignment
    :PROPERTIES:
    :CUSTOM_ID: stop-assignment
    :END:

**** Set/Parameters
     :PROPERTIES:
     :CUSTOM_ID: setparameters
     :END:

| Identifier   | Index/Set Domain    | Comment                                                |
|--------------+---------------------+--------------------------------------------------------|
| schools      | S                   | set of schools                                         |
| students     | P                   | set of students                                        |
| $P_s$        | $s \in S$           | set of students attending school s                     |
| Locations    | C                   | set of all locations can serve as bus stops            |
| $C_p$        | $C_p \subseteq C$   | Allowed bus stops for student $p \in P_s$              |
| $d_{p,c}$    |                     | walking distance for student p to a stop $c \in C_p$   |

For student p with special needs may require a "door-to-door" pickup:
the set $C_p$ is a singleton ${c}$, where $d_{p,c} = 0$.

The objective is to minimize the number of stops for each schools and
the total walking distance. This is similar to a facility location
problem.

**** Variable
     :PROPERTIES:
     :CUSTOM_ID: variable
     :END:

$z_c$: binary whether stop c is selected for school S.

$y_{p,c}$: binary whether student p is assigned to stop c.Â 

**** Objective and Constraints
     :PROPERTIES:
     :CUSTOM_ID: objective-and-constraints
     :END:

For each school S, minimize the total number of stops and walking distance:

$$ min \sum_{c \in C} z_c + \beta \sum_{p \in P_s} \sum_{c \in C_p} d_{p,c} y_{p,c}$$

subject to:

1. student p is assigned to c only if stop c is selected for school s.
   $$y_{p,c} \leq z_c,  \forall p \in P_s , c \in C_p$$

2. Each student is assigned to 1 stop
   $$\sum_{c \in C_p} y_{p,c} = 1 ,\forall p \in P_s $$

Where $\beta$ is the trade-off of the total number of stops and walking
distance.

*** Single school routing
    :PROPERTIES:
    :CUSTOM_ID: single-school-routing
    :END:

After the stop assignment, $C_s$ is the set of bus stops which serve
school S.

$n_{c,S}$ is number of students from school S at a stop c.

**** Bus
     :PROPERTIES:
     :CUSTOM_ID: bus
     :END:

     | Identifier             | index/set | comment                             |
     |------------------------+-----------+-------------------------------------|
     | Bus Type               | b/B       |                                     |
     | Capacity $Q_b$         | b         |                                     |
     | Wheelchair spots $W_b$ | b         | fixed number of wheelchair          |
     | Bus depot $Y$          |           | *stored during the night or day???* |

**** Trip
***** Time
     | Identifier                 | comment                                                                |
     |----------------------------+------------------------------------------------------------------------|
     | $t_{c,S}^{pick}$           | length of time to pick all p for S at c; function of $n_{c,S}$         |
     | $t_{S}^{drop}$             | length of time to drop all p at school S; fixed                        |
     | $t_{l_1,l_2,\tau}^{drive}$ | driving time from $l_1$ to  $l_2$ $\in S \cup C \cup Y$ at time $\tau$ |
     | $\tau_S$                   | all buses must arrive at school S at $\tau_S$                          |
     | $t_{S}^{drop}$ + $\tau_S$  | bus free to leave at this time                                         |
     | $T^{max}$                  | maximum time that students allowed to spend on the bus                 |

     $t_{l_1,l_2,\tau}^{drive}$ are deterministic and known, and usual got from API
     such as Google Map. Due to reality, such as accident, and to mitigate the impact
     of the traffic, the drop-off times $t_{S}^{drop}$ is artificially increase to
     say 10-15 minutes even it only takes 3 minutes.

***** Route
      For school S, a feasible route:
 1. no student spends more than $T^{Max}$ between pickup and drop-off.
 2. there exists a type of bus with capacity and carry all students assigned to
    the stops severed by the trip.

Given a feasible route $R$:

$B_R \subseteq B$: the set of types of buses that have the necessary capacity to serve the trip.

$T_R$: service time of the trip, the time between arrival at the stop to the final school


